<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>window上搭建npm私仓（verdaccio） | 起风的琐碎博客记录</title>
    <meta name="generator" content="VuePress 1.9.9">
    
    <meta name="description" content="全栈成长之路，分享前后端以及 DevOps 相关文章，使各端开发者能够突破瓶颈进一步成长。">
    
    <link rel="preload" href="/person/assets/css/0.styles.233a58f2.css" as="style"><link rel="preload" href="/person/assets/js/app.69942934.js" as="script"><link rel="preload" href="/person/assets/js/2.996b1df4.js" as="script"><link rel="preload" href="/person/assets/js/14.ed85b830.js" as="script"><link rel="prefetch" href="/person/assets/js/10.4fb9e760.js"><link rel="prefetch" href="/person/assets/js/11.e6c8d2c8.js"><link rel="prefetch" href="/person/assets/js/12.ba399906.js"><link rel="prefetch" href="/person/assets/js/13.d6643dd1.js"><link rel="prefetch" href="/person/assets/js/15.d4a61c2c.js"><link rel="prefetch" href="/person/assets/js/16.c376c64b.js"><link rel="prefetch" href="/person/assets/js/3.2c80fa4d.js"><link rel="prefetch" href="/person/assets/js/4.a50e9950.js"><link rel="prefetch" href="/person/assets/js/5.09663c1f.js"><link rel="prefetch" href="/person/assets/js/6.73e51c6f.js"><link rel="prefetch" href="/person/assets/js/7.fbc45fdd.js"><link rel="prefetch" href="/person/assets/js/8.a0999577.js"><link rel="prefetch" href="/person/assets/js/9.ba5ea98f.js">
    <link rel="stylesheet" href="/person/assets/css/0.styles.233a58f2.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/person/" class="home-link router-link-active"><!----> <span class="site-name">起风的琐碎博客记录</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/person/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/person/Css/css-flex.html" class="nav-link">
  随记博客
</a></div><div class="nav-item"><a href="/person/Xmind/map.html" class="nav-link">
  思维导图
</a></div> <a href="https://github.com/vuejs/vuepress" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/person/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/person/Css/css-flex.html" class="nav-link">
  随记博客
</a></div><div class="nav-item"><a href="/person/Xmind/map.html" class="nav-link">
  思维导图
</a></div> <a href="https://github.com/vuejs/vuepress" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Css</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/person/Css/css-flex.html" class="sidebar-link">Flex布局</a></li><li><a href="/person/Css/scss.html" class="sidebar-link">SCSS简易教程</a></li><li><a href="/person/Css/css-layout.html" class="sidebar-link">CSS常见布局方案</a></li><li><a href="/person/Css/css-classname.html" class="sidebar-link">CSS命名规范</a></li><li><a href="/person/Css/css-base.html" class="sidebar-link">CSS基础知识</a></li><li><a href="/person/Css/css-bfc.html" class="sidebar-link">CSS-BFC</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Javascript</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/person/Javascript/js-es6-async.html" class="sidebar-link">ES6之async/await</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Npm</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/person/Npm/npm-verdaccio.html" aria-current="page" class="active sidebar-link">window上搭建npm私仓</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/person/Npm/npm-verdaccio.html#安装-verdaccio" class="sidebar-link">安装 verdaccio</a></li><li class="sidebar-sub-header"><a href="/person/Npm/npm-verdaccio.html#启动-verdaccio" class="sidebar-link">启动 verdaccio</a></li><li class="sidebar-sub-header"><a href="/person/Npm/npm-verdaccio.html#安装nrm用来管理npm源" class="sidebar-link">安装nrm用来管理npm源</a></li><li class="sidebar-sub-header"><a href="/person/Npm/npm-verdaccio.html#新建用户" class="sidebar-link">新建用户</a></li><li class="sidebar-sub-header"><a href="/person/Npm/npm-verdaccio.html#新建一个项目-并发布" class="sidebar-link">新建一个项目，并发布</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/person/Npm/npm-verdaccio.html#附注" class="sidebar-link">附注</a></li></ul></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="window上搭建npm私仓-verdaccio"><a href="#window上搭建npm私仓-verdaccio" class="header-anchor">#</a> window上搭建npm私仓（verdaccio）</h1> <h2 id="安装-verdaccio"><a href="#安装-verdaccio" class="header-anchor">#</a> 安装 verdaccio</h2> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> <span class="token function">install</span> <span class="token parameter variable">-g</span> verdaccio --unsafe-perm
</code></pre></div><h2 id="启动-verdaccio"><a href="#启动-verdaccio" class="header-anchor">#</a> 启动 verdaccio</h2> <div class="language-shell extra-class"><pre class="language-shell"><code>verdaccio
</code></pre></div><p>观察输出, 找到配置文件的路径</p> <div class="language-shell extra-class"><pre class="language-shell"><code>info --- Creating default config <span class="token function">file</span> <span class="token keyword">in</span> D:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>W9011499<span class="token punctuation">\</span>AppData<span class="token punctuation">\</span>Roaming<span class="token punctuation">\</span>verdaccio<span class="token punctuation">\</span>config.yaml
<span class="token comment">## 这里显示了配置文件的所在目录</span>
warn --- config <span class="token function">file</span>  - D:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>W9011499<span class="token punctuation">\</span>AppData<span class="token punctuation">\</span>Roaming<span class="token punctuation">\</span>verdaccio<span class="token punctuation">\</span>config.yaml
warn --- Plugin successfully loaded: verdaccio-htpasswd
warn --- Plugin successfully loaded: verdaccio-audit
<span class="token comment">## 这里显示了监听的端口为: 4873, 可通过 http://localhost:4873/ 访问, 后续还需要可以修改配置文件, 让其他人可访问</span>
warn --- http address - http://localhost:4873/ - verdaccio/5.0.4
</code></pre></div><p>原始配置文件<code>config.yaml</code>内容，地址（<code>C:\Users\Admin\AppData\Roaming\verdaccio</code>）</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token comment">#</span>
<span class="token comment"># This is the default config file. It allows all users to do anything,</span>
<span class="token comment"># so don't use it on production systems.</span>
<span class="token comment">#</span>
<span class="token comment"># Look here for more config file examples:</span>
<span class="token comment"># https://github.com/verdaccio/verdaccio/tree/master/conf</span>
<span class="token comment">#</span>

<span class="token comment"># path to a directory with all packages</span>
<span class="token key atrule">storage</span><span class="token punctuation">:</span> ./storage
<span class="token comment"># path to a directory with plugins to include</span>
<span class="token key atrule">plugins</span><span class="token punctuation">:</span> ./plugins

<span class="token key atrule">web</span><span class="token punctuation">:</span>
  <span class="token key atrule">title</span><span class="token punctuation">:</span> Verdaccio
  <span class="token comment"># comment out to disable gravatar support</span>
  <span class="token comment"># gravatar: false</span>
  <span class="token comment"># by default packages are ordercer ascendant (asc|desc)</span>
  <span class="token comment"># sort_packages: asc</span>
  <span class="token comment"># convert your UI to the dark side</span>
  <span class="token comment"># darkMode: true</span>
  <span class="token comment"># logo: http://somedomain/somelogo.png</span>
  <span class="token comment"># favicon: http://somedomain/favicon.ico | /path/favicon.ico</span>

<span class="token comment"># translate your registry, api i18n not available yet</span>
<span class="token comment"># i18n:</span>
<span class="token comment"># list of the available translations https://github.com/verdaccio/ui/tree/master/i18n/translations</span>
<span class="token comment">#   web: en-US</span>

<span class="token key atrule">auth</span><span class="token punctuation">:</span>
  <span class="token key atrule">htpasswd</span><span class="token punctuation">:</span>
    <span class="token key atrule">file</span><span class="token punctuation">:</span> ./htpasswd
    <span class="token comment"># Maximum amount of users allowed to register, defaults to &quot;+inf&quot;.</span>
    <span class="token comment"># You can set this to -1 to disable registration.</span>
    <span class="token comment"># max_users: 1000</span>

<span class="token comment"># a list of other known repositories we can talk to</span>
<span class="token key atrule">uplinks</span><span class="token punctuation">:</span>
  <span class="token key atrule">npmjs</span><span class="token punctuation">:</span>
    <span class="token key atrule">url</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//registry.npmjs.org/

<span class="token key atrule">packages</span><span class="token punctuation">:</span>
  <span class="token key atrule">'@*/*'</span><span class="token punctuation">:</span>
    <span class="token comment"># scoped packages</span>
    <span class="token key atrule">access</span><span class="token punctuation">:</span> $all
    <span class="token key atrule">publish</span><span class="token punctuation">:</span> $authenticated
    <span class="token key atrule">unpublish</span><span class="token punctuation">:</span> $authenticated
    <span class="token key atrule">proxy</span><span class="token punctuation">:</span> npmjs

  <span class="token key atrule">'**'</span><span class="token punctuation">:</span>
    <span class="token comment"># allow all users (including non-authenticated users) to read and</span>
    <span class="token comment"># publish all packages</span>
    <span class="token comment">#</span>
    <span class="token comment"># you can specify usernames/groupnames (depending on your auth plugin)</span>
    <span class="token comment"># and three keywords: &quot;$all&quot;, &quot;$anonymous&quot;, &quot;$authenticated&quot;</span>
    <span class="token key atrule">access</span><span class="token punctuation">:</span> $all

    <span class="token comment"># allow all known users to publish/publish packages</span>
    <span class="token comment"># (anyone can register by default, remember?)</span>
    <span class="token key atrule">publish</span><span class="token punctuation">:</span> $authenticated
    <span class="token key atrule">unpublish</span><span class="token punctuation">:</span> $authenticated

    <span class="token comment"># if package is not available locally, proxy requests to 'npmjs' registry</span>
    <span class="token key atrule">proxy</span><span class="token punctuation">:</span> npmjs

<span class="token comment"># You can specify HTTP/1.1 server keep alive timeout in seconds for incoming connections.</span>
<span class="token comment"># A value of 0 makes the http server behave similarly to Node.js versions prior to 8.0.0, which did not have a keep-alive timeout.</span>
<span class="token comment"># WORKAROUND: Through given configuration you can workaround following issue https://github.com/verdaccio/verdaccio/issues/301. Set to 0 in case 60 is not enough.</span>
<span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">keepAliveTimeout</span><span class="token punctuation">:</span> <span class="token number">60</span>

<span class="token key atrule">middlewares</span><span class="token punctuation">:</span>
  <span class="token key atrule">audit</span><span class="token punctuation">:</span>
    <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>

<span class="token comment"># log settings</span>
<span class="token key atrule">logs</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token key atrule">type</span><span class="token punctuation">:</span> stdout<span class="token punctuation">,</span> <span class="token key atrule">format</span><span class="token punctuation">:</span> pretty<span class="token punctuation">,</span> <span class="token key atrule">level</span><span class="token punctuation">:</span> http <span class="token punctuation">}</span>

<span class="token comment">#experiments:</span>
<span class="token comment">#  # support for npm token command</span>
<span class="token comment">#  token: false</span>
<span class="token comment">#  # support for the new v1 search endpoint, functional by incomplete read more on ticket 1732</span>
<span class="token comment">#  search: false</span>
<span class="token comment">#  # disable writing body size to logs, read more on ticket 1912</span>
<span class="token comment">#  bytesin_off: false</span>

<span class="token comment"># This affect the web and api (not developed yet)</span>
<span class="token comment">#i18n:</span>
<span class="token comment">#web: en-US</span>
</code></pre></div><p>在配置文件<code>config.yaml</code>的末尾添加 <code>listen: 0.0.0.0:4873</code>，配置此选项则是允许任何外部的所有IP都可以访问到此服务</p> <p>修改npm仓库的实际存储位置. 如: <code>D:/npm-repo</code></p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token comment">#</span>
<span class="token comment"># This is the default config file. It allows all users to do anything,</span>
<span class="token comment"># so don't use it on production systems.</span>
<span class="token comment">#</span>
<span class="token comment"># Look here for more config file examples:</span>
<span class="token comment"># https://github.com/verdaccio/verdaccio/tree/master/conf</span>
<span class="token comment">#</span>

<span class="token comment"># path to a directory with all packages</span>
<span class="token key atrule">storage</span><span class="token punctuation">:</span> D<span class="token punctuation">:</span>/npm<span class="token punctuation">-</span>repo
<span class="token comment"># path to a directory with plugins to include</span>
<span class="token key atrule">plugins</span><span class="token punctuation">:</span> ./plugins

<span class="token key atrule">web</span><span class="token punctuation">:</span>
  <span class="token key atrule">title</span><span class="token punctuation">:</span> Verdaccio
  <span class="token comment"># comment out to disable gravatar support</span>
  <span class="token comment"># gravatar: false</span>
  <span class="token comment"># by default packages are ordercer ascendant (asc|desc)</span>
  <span class="token comment"># sort_packages: asc</span>
  <span class="token comment"># convert your UI to the dark side</span>
  <span class="token comment"># darkMode: true</span>
  <span class="token comment"># logo: http://somedomain/somelogo.png</span>
  <span class="token comment"># favicon: http://somedomain/favicon.ico | /path/favicon.ico</span>

<span class="token comment"># translate your registry, api i18n not available yet</span>
<span class="token comment"># i18n:</span>
<span class="token comment"># list of the available translations https://github.com/verdaccio/ui/tree/master/i18n/translations</span>
<span class="token comment">#   web: en-US</span>

<span class="token key atrule">auth</span><span class="token punctuation">:</span>
  <span class="token key atrule">htpasswd</span><span class="token punctuation">:</span>
    <span class="token key atrule">file</span><span class="token punctuation">:</span> ./htpasswd
    <span class="token comment"># Maximum amount of users allowed to register, defaults to &quot;+inf&quot;.</span>
    <span class="token comment"># You can set this to -1 to disable registration.</span>
    <span class="token comment"># max_users: 1000</span>

<span class="token comment"># a list of other known repositories we can talk to</span>
<span class="token key atrule">uplinks</span><span class="token punctuation">:</span>
  <span class="token key atrule">npmjs</span><span class="token punctuation">:</span>
    <span class="token key atrule">url</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//registry.npmjs.org/

<span class="token key atrule">packages</span><span class="token punctuation">:</span>
  <span class="token key atrule">'@*/*'</span><span class="token punctuation">:</span>
    <span class="token comment"># scoped packages</span>
    <span class="token key atrule">access</span><span class="token punctuation">:</span> $all
    <span class="token key atrule">publish</span><span class="token punctuation">:</span> $authenticated
    <span class="token key atrule">unpublish</span><span class="token punctuation">:</span> $authenticated
    <span class="token key atrule">proxy</span><span class="token punctuation">:</span> npmjs

  <span class="token key atrule">'**'</span><span class="token punctuation">:</span>
    <span class="token comment"># allow all users (including non-authenticated users) to read and</span>
    <span class="token comment"># publish all packages</span>
    <span class="token comment">#</span>
    <span class="token comment"># you can specify usernames/groupnames (depending on your auth plugin)</span>
    <span class="token comment"># and three keywords: &quot;$all&quot;, &quot;$anonymous&quot;, &quot;$authenticated&quot;</span>
    <span class="token key atrule">access</span><span class="token punctuation">:</span> $all

    <span class="token comment"># allow all known users to publish/publish packages</span>
    <span class="token comment"># (anyone can register by default, remember?)</span>
    <span class="token key atrule">publish</span><span class="token punctuation">:</span> $authenticated
    <span class="token key atrule">unpublish</span><span class="token punctuation">:</span> $authenticated

    <span class="token comment"># if package is not available locally, proxy requests to 'npmjs' registry</span>
    <span class="token key atrule">proxy</span><span class="token punctuation">:</span> npmjs

<span class="token comment"># You can specify HTTP/1.1 server keep alive timeout in seconds for incoming connections.</span>
<span class="token comment"># A value of 0 makes the http server behave similarly to Node.js versions prior to 8.0.0, which did not have a keep-alive timeout.</span>
<span class="token comment"># WORKAROUND: Through given configuration you can workaround following issue https://github.com/verdaccio/verdaccio/issues/301. Set to 0 in case 60 is not enough.</span>
<span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">keepAliveTimeout</span><span class="token punctuation">:</span> <span class="token number">60</span>

<span class="token key atrule">middlewares</span><span class="token punctuation">:</span>
  <span class="token key atrule">audit</span><span class="token punctuation">:</span>
    <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>

<span class="token comment"># log settings</span>
<span class="token key atrule">logs</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token key atrule">type</span><span class="token punctuation">:</span> stdout<span class="token punctuation">,</span> <span class="token key atrule">format</span><span class="token punctuation">:</span> pretty<span class="token punctuation">,</span> <span class="token key atrule">level</span><span class="token punctuation">:</span> http <span class="token punctuation">}</span>

<span class="token comment">#experiments:</span>
<span class="token comment">#  # support for npm token command</span>
<span class="token comment">#  token: false</span>
<span class="token comment">#  # support for the new v1 search endpoint, functional by incomplete read more on ticket 1732</span>
<span class="token comment">#  search: false</span>
<span class="token comment">#  # disable writing body size to logs, read more on ticket 1912</span>
<span class="token comment">#  bytesin_off: false</span>

<span class="token comment"># This affect the web and api (not developed yet)</span>
<span class="token comment">#i18n:</span>
<span class="token comment">#web: en-US</span>
<span class="token key atrule">listen</span><span class="token punctuation">:</span> 0.0.0.0<span class="token punctuation">:</span><span class="token number">4873</span>
</code></pre></div><h2 id="安装nrm用来管理npm源"><a href="#安装nrm用来管理npm源" class="header-anchor">#</a> 安装nrm用来管理npm源</h2> <p>安装nrm用来管理npm源，添加和切换很方便，使用<code>npm install -g nrm</code>安装</p> <p>执行<code>nrm ls</code>查看有哪些npm源
此时win10环境可能会报错</p> <div class="language-shell extra-class"><pre class="language-shell"><code>internal/validators.js:124
    throw new ERR_INVALID_ARG_TYPE<span class="token punctuation">(</span>name, <span class="token string">'string'</span>, value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    ^

<span class="token punctuation">[</span>TypeError <span class="token punctuation">[</span>ERR_INVALID_ARG_TYPE<span class="token punctuation">]</span>: The <span class="token string">&quot;path&quot;</span> argument must be of <span class="token builtin class-name">type</span> string. Received undefined
  at validateString <span class="token punctuation">(</span>internal/validators.js:124:11<span class="token punctuation">)</span>
  at Object.join <span class="token punctuation">(</span>path.js:375:7<span class="token punctuation">)</span>
  at Object.<span class="token operator">&lt;</span>anonymous<span class="token operator">&gt;</span> <span class="token punctuation">(</span>D:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>W9011499<span class="token punctuation">\</span>AppData<span class="token punctuation">\</span>Roaming<span class="token punctuation">\</span>npm<span class="token punctuation">\</span>node_modules<span class="token punctuation">\</span>nrm<span class="token punctuation">\</span>cli.js:17:20<span class="token punctuation">)</span>
  at Module._compile <span class="token punctuation">(</span>internal/modules/cjs/loader.js:1063:30<span class="token punctuation">)</span>
  at Object.Module._extensions<span class="token punctuation">..</span>js <span class="token punctuation">(</span>internal/modules/cjs/loader.js:1092:10<span class="token punctuation">)</span>
  at Module.load <span class="token punctuation">(</span>internal/modules/cjs/loader.js:928:32<span class="token punctuation">)</span>
  at Function.Module._load <span class="token punctuation">(</span>internal/modules/cjs/loader.js:769:14<span class="token punctuation">)</span>
  at Function.executeUserEntryPoint <span class="token punctuation">[</span>as runMain<span class="token punctuation">]</span> <span class="token punctuation">(</span>internal/modules/run_main.js:72:12<span class="token punctuation">)</span>
  at internal/main/run_main_module.js:17:47
<span class="token punctuation">]</span> <span class="token punctuation">{</span>
  code: <span class="token string">'ERR_INVALID_ARG_TYPE'</span>
<span class="token punctuation">}</span>
</code></pre></div><p>打开<code>C:\Users\Administrator\AppData\Roaming\npm\node_modules\nrm\cli.js</code>(17行左右)
把</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// const NRMRC = path.join(process.env.HOME, '.nrmrc');</span>
改成下面这样既可
<span class="token keyword">const</span> <span class="token constant">NRMRC</span> <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">[</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>platform <span class="token operator">==</span> <span class="token string">'win32'</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">'USERPROFILE'</span> <span class="token operator">:</span> <span class="token string">'HOME'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'.nrmrc'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>再次执行: <code>nrm ls</code></p> <div class="language-shell extra-class"><pre class="language-shell"><code>* <span class="token function">npm</span> -------- https://registry.npmjs.org/
  <span class="token function">yarn</span> ------- https://registry.yarnpkg.com/
  cnpm ------- http://r.cnpmjs.org/
  taobao ----- https://registry.npm.taobao.org/
  nj --------- https://registry.nodejitsu.com/
  npmMirror -- https://skimdb.npmjs.com/registry/
  edunpm ----- http://registry.enpmjs.org/
</code></pre></div><p>由于电脑的Ip是自动获取的，当电脑重启IP有可能会改变，因此最好需要手动设置一个IP，然后使用
<code>nrm add localnpm http://192.168.1.250:4873</code>添加到npm源中</p> <div class="language-shell extra-class"><pre class="language-shell"><code>D:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>W901149<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span>nrm <span class="token function">add</span> localnpm http://172.17.206.246:4873

    <span class="token function">add</span> registry localnpm success
</code></pre></div><p>然后通过nrm ls来查看有哪些源，带*号的表示目前正在使用的源</p> <div class="language-shell extra-class"><pre class="language-shell"><code>D:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>W901149<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span>nrm <span class="token function">ls</span>

* <span class="token function">npm</span> -------- https://registry.npmjs.org/
  <span class="token function">yarn</span> ------- https://registry.yarnpkg.com/
  cnpm ------- http://r.cnpmjs.org/
  taobao ----- https://registry.npm.taobao.org/
  nj --------- https://registry.nodejitsu.com/
  npmMirror -- https://skimdb.npmjs.com/registry/
  edunpm ----- http://registry.enpmjs.org/
  localnpm --- http://172.17.206.246:4873/
</code></pre></div><p>通过<code>nrm use localnpm</code>来切换源，如下图所示，我们就切换到我们刚刚添加的源了</p> <div class="language-shell extra-class"><pre class="language-shell"><code>D:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>W901149<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span>nrm use localnpm


   Registry has been <span class="token builtin class-name">set</span> to: http://172.17.206.246:4873/

D:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>W901149<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span>nrm <span class="token function">ls</span>

  <span class="token function">npm</span> -------- https://registry.npmjs.org/
  <span class="token function">yarn</span> ------- https://registry.yarnpkg.com/
  cnpm ------- http://r.cnpmjs.org/
  taobao ----- https://registry.npm.taobao.org/
  nj --------- https://registry.nodejitsu.com/
  npmMirror -- https://skimdb.npmjs.com/registry/
  edunpm ----- http://registry.enpmjs.org/
* localnpm --- http://172.17.206.246:4873/
</code></pre></div><h2 id="新建用户"><a href="#新建用户" class="header-anchor">#</a> 新建用户</h2> <p>然后通过<code>npm adduser --registry http://localhost:4873/</code>来新建一个用户</p> <div class="language-shell extra-class"><pre class="language-shell"><code>D:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>W901149<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span>nrm <span class="token function">ls</span>

  <span class="token function">npm</span> -------- https://registry.npmjs.org/
  <span class="token function">yarn</span> ------- https://registry.yarnpkg.com/
  cnpm ------- http://r.cnpmjs.org/
  taobao ----- https://registry.npm.taobao.org/
  nj --------- https://registry.nodejitsu.com/
  npmMirror -- https://skimdb.npmjs.com/registry/
  edunpm ----- http://registry.enpmjs.org/
* localnpm --- http://172.17.206.246:4873/


Username: pan
Password:
Email: <span class="token punctuation">(</span>this IS public<span class="token punctuation">)</span> sd40150700@126.com
Logged <span class="token keyword">in</span> as pan on http://172.17.206.246:4873/.
</code></pre></div><h2 id="新建一个项目-并发布"><a href="#新建一个项目-并发布" class="header-anchor">#</a> 新建一个项目，并发布</h2> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">mkdir</span> testdemo
<span class="token builtin class-name">cd</span> testdemo
<span class="token function">npm</span> init
<span class="token comment"># 创建webpack配置文件</span>
<span class="token function">touch</span> webpack.config.js
<span class="token comment"># 创建src目录</span>
<span class="token function">mkdir</span> src
<span class="token builtin class-name">cd</span> src
<span class="token comment"># 在src目录创建hello.js文件</span>
<span class="token function">touch</span> hello.js
<span class="token builtin class-name">cd</span> <span class="token punctuation">..</span>src
<span class="token comment"># 在项目根目录进行打包</span>
webpack
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// hello.js</span>
<span class="token keyword">function</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>修改<code>package.json</code>, 增加<code>files</code>配置, 将<code>src</code>目录与<code>dist</code>目录一同发布到<code>npm</code>仓库</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;testdemo&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.0&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;private&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token property">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;dist/index.js&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;files&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span>
    <span class="token string">&quot;dist&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;src&quot;</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;author&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;license&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ISC&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;devDependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;webpack&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^5.37.1&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;webpack-cli&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^4.7.0&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>npm</code> 登录: <code>npm login</code></p> <p>npm发布: <code>npm publish</code></p> <p>查看已发布的npm资源</p> <p><code>http://localhost:4873</code></p> <h3 id="附注"><a href="#附注" class="header-anchor">#</a> 附注</h3> <p>如果本地源没有会向外网去寻找下载，配置外网的npm是找到<code>config.yaml</code>配置文件找到<code>uplinks</code>，填写上一级<code>npm</code>仓库的地址，如下所示：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token comment"># a list of other known repositories we can talk to</span>
<span class="token key atrule">uplinks</span><span class="token punctuation">:</span>
  <span class="token key atrule">npmjs</span><span class="token punctuation">:</span>
    <span class="token key atrule">url</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//registry.npmjs.org/
</code></pre></div><p>参考链接：<a href="https://www.jianshu.com/p/b5e68aaad191" target="_blank" rel="noopener noreferrer">window上搭建npm私仓（verdaccio）<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/vuejs/vuepress/edit/master/docs/Npm/npm-verdaccio.md" target="_blank" rel="noopener noreferrer">帮助我们改善此页面！</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/person/Javascript/js-es6-async.html" class="prev">
        ES6之async/await
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/person/assets/js/app.69942934.js" defer></script><script src="/person/assets/js/2.996b1df4.js" defer></script><script src="/person/assets/js/14.ed85b830.js" defer></script>
  </body>
</html>
